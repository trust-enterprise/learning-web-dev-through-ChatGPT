<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h2>Shopping Cart</h2><hr>
    <div id="productContainer"></div>
    <h3>Your Cart</h3>
    <div id="cartContainer"></div>
    <button id="clrCartContainerBtn">clear cart</button>

    <h2 align="center"><font color="red">learning</font></h2>
    <ol>
        <li>when a passed object is recieved with spread operator (...obj), a copy of the object is created and the original one remains unaffected</li>
    </ol>

    <script>
        //init global var
        let product = [
            {id:1, name:'product1', price: 100},
            {id:2, name:'product2', price: 200},
            {id:3, name:'product3', price: 300}
        ]
        let cartDetails = getCartFromLocal()

        //get DOM ele
        let productContainer = document.getElementById('productContainer')
        let cartContainer = document.getElementById('cartContainer')
        let clrCartContainerBtn = document.getElementById('clrCartContainerBtn')
        //let  = document.getElementById('')

        //--PRIMARY FUNCTIONS

        document.addEventListener('DOMContentLoaded', ()=>{
            displayProducts()

            //access existing cart if any
            let cartDetails = getCartFromLocal()

            if(cartDetails.length === 0){
                alert(`your cart is empty`)
            }else{
                cartContainer.textContent = ''
                displayCartOnUI(cartDetails)
            }
        }) 

        //--SECONDARY FUNCTIONS

        //display products to choose from 
        function displayProducts(){
            product.forEach(product => {
                let productDiv = document.createElement('div')
                productDiv.textContent = `${product.id}. ${product.name} : $${product.price}`
                let addToCartBtn = document.createElement('button')
                addToCartBtn.textContent = `add to cart`
                addToCartBtn.style.marginLeft = '15px'
                addToCartBtn.onclick = ()=> addToCart(product)
                productDiv.appendChild(addToCartBtn)
                cartContainer.appendChild(productDiv)
            })
        }
        
        //display the cart products from local on ui
        function displayCartOnUI(cartDetails){ 
            cartDetails.forEach(localProd => {
                let cartItemDiv = document.createElement('div')
                div.textContent =  `${product.id}. ${product.name} : $${product.price}x${product.quantity}`
                let removeProductBtn = document.createElement('button')
                removeProductBtn.textContent = `remove`
                removeProductBtn.style.marginLeft = '15px'
                removeProductBtn.onclick = ()=> removeProduct(product)
                cartItemDiv.appendChild(removeProductBtn)
                cartContainer.appendChild(cartItemDiv)
            })
        }
        
        //add a single product to cart
        function addToCart(product){
            
            //add product to local, or increase existing count if already in cart
            let existingProduct = cartDetails.find(cartItem => cartItem.id === product.id)
            if(!existingProduct){
                cartDetails.push({...product, quantity:1})
                sendCartDetailsToLocal(cartDetails)
            }else{
                product.quantity +=1;
            }
            
            displayCartOnUI(product)
        }
        
        //remove a product from cart and local
        function removeProduct(product){
            //update local 
            let updatedCartPostRemoval = cartDetails.filter(localProd => localProd.id !== product.id)
            sendCartDetailsToLocal(updatedCartPostRemoval)

            //update ui 
            displayCartDetails(updatedCartPostRemoval)
            if(cartContainer.childElementCount.length === 0){
                cartContainer.textContent = 'no items in the cart'
            } 
        }

        //accessing cart details from browser (local)
        function getCartFromLocal(){
            return JSON.parse(localStorage.getItem('cartItems')) || []
        }

        //send cart details to local storage
        function sendCartDetailsToLocal(cartDetails){
            localStorage.setItem('cartItems',JSON.stringify(cartDetails))
        }

    </script>
</body>
</html>